name: Draft release on tag

on:
  push:
    tags:
      - 'v*'
      - 'V*'

jobs:
  draft-release:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # Optional: build an artifact
      - name: Build artifact
        run: |
          mkdir -p artifacts
          echo "Hello from tag ${{ github.ref_name }}" > artifacts/hello.txt

      # Optional: simple release notes
      - name: Prepare release notes
        run: |
          release="${{ github.ref_name }}"
          cat > release_notes.md <<EOF
          # Release ${release}

          This is an automatically created *draft* release for tag ${release}.
          EOF

      - name: Create draft release
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          set -euo pipefail
          release="${{ github.ref_name }}"

          gh release create "$release" --draft -F release_notes.md -t "Release $release" 
